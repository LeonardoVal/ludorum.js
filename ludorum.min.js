//! ludorum 0.1.0 (2014-01-13)
"use strict";!function(a){if("function"==typeof define&&define.amd)define(["basis"],a);else if("object"==typeof module&&module.exports)module.exports=a(require("basis"));else{var b=(0,eval)("this");b.inveniemus=a(b.basis)}}(function(a){var b={},c=b.Game=a.declare({constructor:function(a){this.activePlayers=a?Array.isArray(a)?a:[a]:[this.players[0]]},name:"",players:[],moves:function(){for(var a={},b=0;b<this.activePlayers.length;b++)a[this.activePlayers[b]]=[];return a},next:function(){throw new Error((this.constructor.name||"Game")+".next() not implemented! Please override.")},result:function(){return this.moves()?null:this.defeat()},isActive:function(){for(var a=0;a<arguments.length;a++)if(this.activePlayers.indexOf(arguments[a])<0)return!1;return!0},activePlayer:function(){var b=this.activePlayers.length;return a.raiseIf(1>b,"There is no active player."),a.raiseIf(b>1,"More than one player is active."),this.activePlayers[0]},opponents:function(a){return a=a||this.activePlayers,iterable(this.players).filter(function(b){return a.indexOf(b)<0}).toArray()},opponent:function(a){var b=this.players.indexOf(a||this.activePlayer());return this.players[(b+1)%this.players.length]},doMove:function(a,b){b=b||this.activePlayer();var c={};return c[b]=a,this.next(c)},resultBounds:function(){return[-1,1]},zerosumResult:function(a,b){b=b?Array.isArray(b)?b:[b]:this.activePlayers,a=+a/(b.length||1);for(var c,d={},e=-a/(this.players.length-b.length||1),f=0;f<this.players.length;f++)c=this.players[f],d[c]=b.indexOf(c)<0?e:a;return d},victory:function(a,b){return this.zerosumResult(b||1,a)},defeat:function(a,b){return this.zerosumResult(b||-1,a)},draw:function(a,b){b=+(b||0),a=a||this.players;var c={};for(var d in a)c[a[d]]=b;return c},args:function(){throw new Error("Game.args() not implemented! Please override.")},clone:function(){var a=this.args();return a[0]=this.constructor,new(a[0].bind.apply(a[0],a))},identifier:function(){return JSON.stringify(this.args())},toString:function(){var a=this.args();return a.shift()+"("+a.map(JSON.stringify).join(",")+")"}}),d=b.games={};c.serialized=function(){var b=this.prototype.moves,c=this.prototype.next;return a.declare(this,{moves:function d(){for(var a,c=this.__fixedMoves__||(this.__fixedMoves__={}),e=b.call(this),d={},f=0;f<this.activePlayers.length;f++)if(c.hasOwnProperty(this.activePlayers[f])){a=this.activePlayers[f];break}return a&&e?(d[a]=e[a],d):null},next:function(b){var d,e=a.copy({},this.fixedMoves||{},b),f=iterable(this.players).all(function(a){return e.hasOwnProperty(a)});return f?(d=c.call(this,e),d.fixedMoves={}):(d=this.clone(),d.fixedMoves=e),d}})},c.cached=function(){{var b=this.prototype.moves,c=this.prototype.result;this.prototype.next}return a.declare(this,{moves:function(){var a=b.call(this);return this.moves=function(){return a},a},result:function d(){var d=c.call(this);return this.result=function(){return d},d}})};var e=b.Player=a.declare({constructor:function(){var a=0;return function(b){this.name=""+(b||"Player"+a++)}}(),__moves__:function(b,c){var d=b.moves();return a.raiseIf(!d||!d[c]||d[c].length<1,"Player ",c," has no moves for game ",b,"."),d[c]},decision:function(a,b){return this.__moves__(a,b)[0]},participate:function(){return this},commandQuit:function(a){return{command:"quit",role:a}},commandReset:function(a,b){return{command:"reset",role:a,ply:isNaN(b)?0:+b}}}),f=b.players={},g=b.Match=a.declare({constructor:function(b,c){this.game=b,this.players=Array.isArray(c)?a.iterable(b.players).zip(c).toObject():c,this.history=[b],this.events=new a.Events({events:["begin","move","next","end"]});for(var d in this.players)this.players[d]=this.players[d].participate(this,d)||this.players[d]},ply:function(){return this.history.length-1},toString:function(){return"Match("+this.game+", "+JSON.stringify(this.players)+")"},state:function(a){return a=isNaN(a)?this.ply():0>+a?this.ply()+ +a:+a,this.history[0|a]},result:function(){return this.state().result()},decisions:function(b){b=b||this.state();var c=this.players;return a.Future.all(b.activePlayers.map(function(d){return a.when(c[d].decision(b,d))}))},__advance__:function(a,b){return this.history.push(b),this.onNext(a,b),b},run:function(b){if(b=isNaN(b)?1/0:+b,1>b)return a.when(this);var c,d=this.ply(),e=this.state();for(0>d&&this.onBegin(e);e instanceof j;)e=this.__advance__(e,e.instantiate());if(c=e.result())return this.onEnd(e,c),a.when(this);var f=this;return this.decisions(e).then(function(c){return c=a.iterable(e.activePlayers).zip(c).toObject(),f.onMove(e,c),f.__advance__(e,e.next(c)),f.run(b-1)})},onBegin:function(b){this.events.emit("begin",this.players,b,this),this.logger&&this.logger.info("Match begins with ",a.iterable(this.players).map(function(a){return a[1]+" as "+a[0]}).join(", "),"; for ",b,".")},onMove:function(a,b){this.events.emit("move",b,a,this),this.logger&&this.logger.info("Players move: ",JSON.stringify(b)," in ",a)},onNext:function(a,b){this.events.emit("next",a,b,this),this.logger&&this.logger.info("Match advances from ",a," to ",b)},onEnd:function(a,b){this.events.emit("end",a,b,this),this.logger&&this.logger.info("Match for ",a,"ends with ",JSON.stringify(b))}}),h=b.Tournament=a.declare({constructor:function(b,c){this.game=b,this.players=Array.isArray(c)?c:iterables.iterable(c).toArray(),this.statistics=new a.Statistics,this.events=new a.Events({events:["begin","beforeMatch","afterMatch","end"]})},account:function(b){var c=this.game,d=b.result(),e=this.statistics;a.raiseIf(!d,"Match doesn't have results. Has it finished?"),a.iterable(b.players).forEach(function(a){var f=a[0],g=a[1],h=d[a[0]],i=["game:"+c.name,"role:"+f,"player:"+g.name];e.add(i.concat("results"),h),e.add(i.concat(h>0?"victories":0>h?"defeats":"draws"),h),e.add(i.concat("length"),b.ply()),b.history.forEach(function(a){if("function"==typeof a.moves){var b=a.moves();b&&b.hasOwnProperty(f)&&b[f].length>0&&e.add(i.concat("width"),b[f].length)}})})},run:function(b){this.onBegin();var c=this;return b=b||this.matches(),a.Future.sequence(b,function(a){return c.beforeMatch(a),a.run().then(function(a){return c.account(a),c.afterMatch(a),c})}).then(this.onEnd.bind(this))},matches:function(){throw new Error("Tournament.matches is not implemented. Please override.")},onBegin:function(){this.events.emit("begin",this),this.logger&&this.logger.info("Tournament begins for game ",game.name,".")},beforeMatch:function(a){this.events.emit("beforeMatch",a,this),this.logger&&this.logger.debug("Beginning match with ",JSON.stringify(a.players),".")},afterMatch:function(a){this.events.emit("afterMatch",a,this),this.logger&&this.logger.debug("Finishing match with ",JSON.stringify(a.players),".")},onEnd:function(){this.events.emit("end",this.statistics,this),this.logger&&this.logger.info("Tournament ends for game ",game.name,":\n",this.statistics,"\n")}}),i=b.tournaments={},j=b.Aleatory=a.declare({constructor:function(b,c){this.next=b,this.random=c||a.Randomness.DEFAULT},instantiate:function(){return this.next(this.value())},value:function n(){var n,b=random.random();if(a.iterable(this.distribution()).forEach(function(c){if(b-=c[1],0>=b)throw n=c[0],a.Iterable.STOP_ITERATION}),"undefined"==typeof n)throw new Error("Random value could not be obtained.");return n},distribution:function(){throw new Error((this.constructor.name||"Aleatory")+".distribution() is not implemented! Please override.")}}),k=b.aleatories={};f.RandomPlayer=a.declare(e,{constructor:function(b,c){e.call(this,b),this.random=c||a.Randomness.DEFAULT},toString:function(){return"RandomPlayer("+JSON.stringify(this.name)+")"},decision:function(a,b){return this.random.choice(this.__moves__(a,b))}}),f.TracePlayer=a.declare(e,{constructor:function(b,c){e.call(this,b),this.trace=a.iterable(c),this.__iterator__=this.trace.__iter__(),this.__decision__=this.__iterator__()},toString:function(){return"TracePlayer("+JSON.stringify(this.name)+", ["+this.trace.join(", ")+"])"},decision:function(){try{this.__decision__=this.__iterator__()}catch(b){a.Iterable.prototype.catchStop(b)}return this.__decision__}});var l=f.HeuristicPlayer=a.declare(e,{constructor:function(b,c,d,f){e.call(this,b),this.random=c||a.Randomness.DEFAULT,d&&(this.moveEvaluation=d),f&&(this.stateEvaluation=f)},toString:function(){return"HeuristicPlayer("+JSON.stringify(this.name)+")"},moveEvaluation:function(b,c,d){return this.stateEvaluation(c.next(a.obj(d,b)),d)},stateEvaluation:function(a,b){var c=a.result();return c?c[b]:this.random.random(-.5,.5)},decision:function(b,c){var d=this,e=new a.Future;return setTimeout(function(){try{for(var a,f,g=-1/0,h=[],i=d.__moves__(b,c),j=0;j<i.length;j++)a=i[j],f=d.moveEvaluation(a,b,c),f>g?(h=[a],g=f):f==g&&h.push(a);e.resolve(d.random.choice(h))}catch(k){e.reject(k)}},1),e}});f.MiniMaxPlayer=a.declare(l,{constructor:function(a,b,c,d){l.call(this,a,d),this.horizon=+(c||3),b&&(this.heuristic=b)},toString:function(){return"MiniMaxPlayer("+JSON.stringify(this.name)+", "+this.horizon+")"},stateEvaluation:function(a,b){var c=this.minimax(a,b,0,-1/0,1/0);return c},heuristic:function(){return this.random.random(-.5,.5)},minimax:function(b,c,d,e,f){var g=b.result();if(g)return g[c];if(d>=this.horizon)return this.heuristic(b,c);var h,i,j=b.activePlayer(),k=j==c,l=this.__moves__(b,j);if(l.length<1)throw new Error("No moves for unfinished game "+b+".");for(var m=0;m<l.length&&(i=b.next(a.obj(j,l[m])),h=this.minimax(i,c,d+1,e,f),k?h>e&&(e=h):f>h&&(f=h),!(e>=f));m++);return k?e:f}}),f.MonteCarloPlayer=a.declare(l,{constructor:function(a,b,c){l.call(this,a,b),this.simulationCount=isNaN(c)?30:+c>>0},stateEvaluation:function(a,b){for(var c=0,d=this.simulationCount;d>0;d--)c+=this.simulation(a,b);return c/this.simulationCount},simulation:function(a,b){var c,d,e=this;for(d=a.moves();d;d=a.moves())c={},a.activePlayers.forEach(function(a){c[a]=e.random.choice(d[a])}),a=a.next(c);return a.result()[b]}});var m=(f.UserInterfacePlayer=a.declare(e,{constructor:function(a){e.call(this,a)},decision:function(){if(this.__future__&&this.__future__.isPending()){var b=new Error("Last decision has not been made. Match probably aborted.");this.__future__.reject(b)}return this.__future__=new a.Future},perform:function(a){var b=this.__future__;return b&&(this.__future__=null,b.resolve(a)),!!b}}),f.UserInterface=a.declare({constructor:function(b,c){this.match=b,a.initialize(this,c).array("players",{defaultValue:b.state().players}),b.events.on("begin",this.onBegin.bind(this)),b.events.on("move",this.onMove.bind(this)),b.events.on("end",this.onEnd.bind(this))},onBegin:function(a,b){this.activePlayer=b.activePlayer(),this.display(b)},onMove:function(a,b,c){this.activePlayer=c.activePlayer(),this.display(c)},onEnd:function(a,b){this.activePlayer=null,this.results=a,this.display(b)},display:function(){throw new Error("UserInterface.display is not defined. Please override.")},perform:function(a,b){if(b=b||this.match.state().activePlayer(),this.players.indexOf(b)>=0){var c=this.match.players[b];c&&"function"==typeof c.perform&&c.perform(a)}}}));return m.BasicHTMLInterface=a.declare(m,{constructor:function(a,c){b.UserInterface.call(this,a,c),this.domElement=c.domElement,"string"==typeof this.domElement&&(this.domElement=document.getElementById(this.domElement))},display:function(a){domElement.innerHTML=a.toHTML()}}),m.KineticJSInterface=a.declare(m,{constructor:function(c,d){b.UserInterface.call(this,c,d),a.initialize(this,d).object("container").object("Kinetic",{defaultValue:window.Kinetic}),this.container.destroyChildren()}}),d.__Predefined__=a.declare(c,{constructor:function(a,b,d,e){b&&(this.__results__=b,this.players=Object.keys(b)),c.call(this,a),this.height=isNaN(d)?5:+d,this.width=isNaN(e)?5:+e},name:"__Predefined__",players:["A","B"],__results__:{A:0,B:0},moves:function(){return this.height>0?a.obj(this.activePlayer(),a.Iterable.range(1,this.width+1).toArray()):void 0},result:function(){return this.height>0?null:this.__results__},next:function(){return new this.constructor(this.opponent(),this.__results__,this.height-1,this.width)},args:function(){return[this.name,this.activePlayer(),this.results,this.height,this.width]},toString:function(){return"__Predefined__("+[this.activePlayer(),this.__results__,this.height,this.width].map(JSON.stringify).join(", ")+")"}}),d.Choose2Win=a.declare(c,{constructor:function(a,b,d){c.call(this,b),this.__turns__=isNaN(a)?1/0:+a,this.__winner__=d},name:"Choose2Win",players:["This","That"],moves:function(){return!this.__winner__&&this.__turns__>0?a.obj(this.activePlayer(),["win","lose","pass"]):void 0},result:function(){return this.__winner__?this.victory(this.__winner__):this.__turns__<1?this.draw():null},next:function(b){var c=this.activePlayer(),d=this.opponent(c);switch(b[c]){case"win":return new this.constructor(this.__turns__-1,d,c);case"lose":return new this.constructor(this.__turns__-1,d,d);case"pass":return new this.constructor(this.__turns__-1,d)}return a.raise("Invalid move "+b[c]+" for player "+c+".")},args:function(){return[this.name,this.__turns__,this.activePlayer(),this.__winner__]},toString:function(){return"Choose2Win("+this.__turns__+","+JSON.stringify(this.activePlayer())+","+JSON.stringify(this.__winner__)+")"}}),d.OddsAndEvens=a.declare(c,{constructor:function(a,b){c.call(this,this.players),this.turns=isNaN(a)?1:+a,this.points=b||{Evens:0,Odds:0}},name:"OddsAndEvens",players:["Evens","Odds"],moves:function(){return this.turns<1?null:{Evens:[1,2],Odds:[1,2]}},result:function(){var a=this.points.Evens-this.points.Odds;return this.turns>0?null:{Evens:+a,Odds:-a}},next:function(a){var b=!((a.Evens+a.Odds)%2);return new this.constructor(this.turns-1,{Evens:this.points.Evens+(b?1:0),Odds:this.points.Odds+(b?0:1)})},args:function(){return[this.name,this.turns,this.points]},toString:function(){return JSON.stringify(this.points)}}),d.TicTacToe=a.declare(c,{constructor:function(a,b){c.call(this,a),this.board=b||"_________"},name:"TicTacToe",players:["Xs","Os"],result:function(){var a=/XXX......|...XXX...|......XXX|X..X..X..|.X..X..X.|..X..X..X|X...X...X|..X.X.X../,b=/OOO......|...OOO...|......OOO|O..O..O..|.O..O..O.|..O..O..O|O...O...O|..O.O.O../;return function(){return this.board.match(a)?this.victory(["Xs"]):this.board.match(b)?this.victory(["Os"]):this.board.indexOf("_")<0?this.draw():null}}(),moves:function(){if(this.result())return null;var b={};return b[this.activePlayer()]=a.iterable(this.board).filter(function(a){return"_"==a},function(a,b){return b}).toArray(),b},next:function(b){var c=this.activePlayer(),d=+b[c];a.raiseIf("_"!==this.board.charAt(d),"Invalid move ",d," for board ",this.board," (moves= ",JSON.stringify(b)+").");var e=this.board.substring(0,d)+c.charAt(0)+this.board.substring(d+1);return new this.constructor(this.opponent(c),e)},args:function(){return[this.name,this.activePlayer(),this.board]},toString:function(){return[this.board.substring(0,2).split("").join("|"),"-+-+-",board.substring(3,5).split("").join("|"),"-+-+-",board.substring(6,8).split("").join("|")].join("\n")}}),d.TicTacToe.heuristics={},d.TicTacToe.heuristics.heuristicFromWeights=function(b){function c(a,c){var e=c.charAt(0);return iterable(a.board).map(function(a,c){return"_"===a?0:b[c]*(a===e?1:-1)}).sum()/d}var d=a.iterable(b).map(Math.abs).sum();return c.weights=b,c},d.TicTacToe.heuristics.defaultHeuristic=d.TicTacToe.heuristics.heuristicFromWeights([2,1,2,1,5,1,2,1,2]),d.ToadsAndFrogs=a.declare(c,{constructor:function o(a,b){c.call(this,a),this.board=b||o.board()},name:"ToadsAndFrogs",players:["Toads","Frogs"],results:function(){return this.moves()?null:this.defeat()},moves:function(){var a=this.activePlayer(),b={},c=b[a]=[];return this.board.replace(a==this.players[0]?/TF?_/g:/_T?F/g,function(a,b){return c.push(b),a}),c.length>0?b:null},next:function(a){var b=this.activePlayer(),c=a[b],d=(b.charAt(0),this.board);if("T_"==d.substr(c,2))d=d.substring(0,c)+"_T"+d.substring(c+2);else if("_F"==d.substr(c,2))d=d.substring(0,c)+"F_"+d.substring(c+2);else if("TF_"==d.substr(c,3))d=d.substring(0,c)+"_FT"+d.substring(c+3);else{if("_TF"!=d.substr(c,3))throw new Error("Invalid move ",c," for board <",d,">.");d=d.substring(0,c)+"FT_"+d.substring(c+3)}return new this.constructor(this.opponent(b),d)},args:function(){return[this.name,this.activePlayer,this.board]},toString:function(){return this.board}}),d.ToadsAndFrogs.board=function(a,b){return a=isNaN(a)?3:+a,b=isNaN(b)?2:+b,"T".repeat(a)+"_".repeat(b)+"F".repeat(a)},d.Mancala=a.declare(c,{constructor:function(a,b){c.call(this,a),this.board=b||this.makeBoard()},makeBoard:function(a,b){a=isNaN(a)?3:+a,b=isNaN(b)?6:+b;for(var c=[],d=0;2>d;d++){for(var e=0;b>e;e++)c.push(a);c.push(0)}return c},name:"Mancala",players:["North","South"],emptyCapture:!1,countRemainingSeeds:!0,store:function(a){switch(this.players.indexOf(a)){case 0:return this.board.length/2-1;case 1:return this.board.length-1;default:throw new Error("Invalid player "+a+".")}},houses:function(b){switch(this.players.indexOf(b)){case 0:return a.Iterable.range(0,this.board.length/2-1).toArray();case 1:return a.Iterable.range(this.board.length/2,this.board.length-1).toArray();default:throw new Error("Invalid player "+b+".")}},oppositeHouse:function(a,b){var c=this.houses(a),d=this.houses(this.opponent(a)),e=c.indexOf(b);return 0>e?e:d.reverse()[e]},nextSquare:function(a,b){do b=(b+1)%this.board.length;while(b===this.store(this.opponent(a)));return b},moves:function(){var a=this.board,b={},c=this.activePlayer();return b[c]=this.houses(c).filter(function(b){return a[b]>0}),b[c].length>0?b:null},result:function p(){if(this.moves())return null;var p={},a=this,b=this.board;return this.players.forEach(function(c){p[c]=b[a.store(c)],a.countRemainingSeeds&&a.houses(c).forEach(function(a){p[c]+=b[a]})}),p[this.players[0]]-=p[this.players[1]],p[this.players[1]]=-p[this.players[0]],p},next:function(b){var c,d,e=this.activePlayer(),f=+b[e],g=this.board.slice(0),h=g[f],i=!1;for(a.raiseIf(1>h,"Invalid move ",f," for game ",this),g[f]=0;h>0;h--)f=this.nextSquare(e,f),g[f]++;return i=f==this.store(e),i||(d=this.oppositeHouse(e,f),d>=0&&1==g[f]&&g[d]>0&&(c=this.store(e),g[c]++,g[f]=0,this.emptyCapture||(g[c]+=g[d],g[d]=0))),new this.constructor(i?e:this.opponent(),g)},resultBounds:function(){var b=a.iterable(this.board).sum();return[-b,+b]},args:function(){return[this.name,this.activePlayer(),this.board.slice()]},identifier:function(){return this.activePlayer().charAt(0)+this.board.map(function(a){return("00"+a.toString(36)).substr(-2)}).join("")},toString:function(){var a=this,b=this.players[0],c=this.houses(b).map(function(b){return(""+a.board[b]).lpad(2,"0")}).reverse(),d=(""+this.board[this.store(b)]).lpad(2,"0"),e=this.players[1],f=this.houses(e).map(function(b){return(""+a.board[b]).lpad(2,"0")}),g=(""+this.board[this.store(e)]).lpad(2,"0");return"   "+c.join(" | ")+"   \n"+d+" ".repeat(2*c.length+3*(c.length-1)+2)+g+"\n   "+f.join(" | ")+"   "}}),d.Mancala.makeBoard=d.Mancala.prototype.makeBoard,d.Mancala.heuristics={},d.Mancala.heuristics.heuristicFromWeights=function(b){function c(c,e){var f,g=0;switch(c.players.indexOf(e)){case 0:f=1;break;case 1:f=-1;break;default:throw new Error("Invalid player "+e+".")}return a.iterable(c.board).map(function(a,c){return g+=a,a*b[c]}).sum()/d/g*f}var d=a.iterable(b).map(Math.abs).sum();return c.weights=b,c},d.Mancala.heuristics.defaultHeuristic=d.Mancala.heuristics.heuristicFromWeights([1,1,1,1,1,1,5,-1,-1,-1,-1,-1,-1,-5]),d.Pig=a.declare(c,{constructor:function(b,d,e){c.call(this,b),this.__scores__=d||a.iterable(this.players).zip([0,0]).toObject(),this.rolls=e||[]},goal:100,name:"Pig",players:["One","Two"],moves:function(){return this.result()?void 0:a.obj(this.activePlayer(),["roll","hold"])},result:function(){if(this.__scores__[this.players[0]]>=this.goal||this.__scores__[this.players[1]]>=this.goal){var a={};return a[this.players[0]]=this.__scores__[this.players[0]]-this.__scores__[this.players[1]],a[this.players[1]]=-a[this.players[0]],a}},next:function(b){var c=this.activePlayer(),d=b[c];if("hold"===d){var e=a.copy(this.__scores__);return e[c]+=a.iterable(this.rolls).sum(),new this.constructor(this.opponent(),e,[])}if("roll"===d){var f=this;return new k.Dice(6,function(a){return a>1?new f.constructor(c,f.__scores__,f.rolls.concat(a)):new f.constructor(f.opponent(),f.__scores__,[])})}throw new Error("Invalid moves: "+JSON.stringify(b))},args:function(){return[this.name,this.activePlayer(),this.__scores__,this.rolls]}}),i.RoundRobin=a.declare(h,{constructor:function(a,b,c){h.call(this,a,b),this.matchCount=isNaN(c)?a.players.length:+c},matches:function(){var b=this.game,c=a.iterable(this.players);return c=c.product.apply(c,a.Iterable.repeat(this.players,b.players.length-1).toArray()),c.filter(function(a){for(var b=1;b<a.length;b++)for(var c=0;b>c;c++)if(a[b]===a[c])return!1;return!0}).product(a.Iterable.range(this.matchCount)).map(function(a){return new g(b,a[0])})}}),i.Measurement=a.declare(h,{constructor:function(b,c,d,e){h.call(this,b,Array.isArray(c)?c:[c]),this.opponents=Array.isArray(d)?d:[d],a.raiseIf(this.opponents.length<b.players.length-1,"Not enough opponents."),this.matchCount=isNaN(e)?b.players.length:+e},matches:function(){var b=this.game,c=b.players.length,d=a.iterable(this.opponents);return d=c>2?d.product.apply(d,a.Iterable.repeat(this.opponents,c-2).toArray()):d.map(function(a){return[a]}),a.iterable(this.players).product(a.Iterable.range(c),d,a.Iterable.range(this.matchCount)).map(function(a){var c=a[2].slice(0);return c.splice(a[1],0,a[0]),new g(b,c)})}}),k.Dice=a.declare(j,{constructor:function(a,b,c){j.call(this,b,c),this.base=isNaN(a)?6:Math.max(2,+a)},value:function(){return this.random.randomInt(1,this.base+1)},distribution:function(){var b=1/this.base;return a.Iterable.range(1,this.base+1).map(function(a){return[a,b]})}}),b});