<!DOCTYPE html><html lang="en"><head><title>src\players\HeuristicPlayer</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="src\players\HeuristicPlayer"><meta name="groc-project-path" content="src\players\HeuristicPlayer.js"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src\players\HeuristicPlayer.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>Base type for automatic players based on heuristic evaluations of game
    states or moves.</p></div></div><div class="code"><div class="wrapper"><span class="kd">var</span> <span class="nx">HeuristicPlayer</span> <span class="o">=</span> <span class="nx">players</span><span class="p">.</span><span class="nx">HeuristicPlayer</span> <span class="o">=</span> <span class="nx">declare</span><span class="p">(</span><span class="nx">Player</span><span class="p">,</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>new players.HeuristicPlayer(params):
    Builds a player that evaluates its moves and chooses one of the best
    evaluated.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">HeuristicPlayer</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Player</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
    <span class="nx">initialize</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.HeuristicPlayer.random=basis.Randomness.DEFAULT:
    Pseudorandom number generator used for random decisions.</p></div></div><div class="code"><div class="wrapper">      <span class="p">.</span><span class="nx">object</span><span class="p">(</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">defaultValue</span><span class="o">:</span> <span class="nx">Randomness</span><span class="p">.</span><span class="nx">DEFAULT</span> <span class="p">})</span>
      <span class="p">.</span><span class="nx">func</span><span class="p">(</span><span class="s1">&#39;heuristic&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">ignore</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.HeuristicPlayer.moveEvaluation(move, game, player):
    Calculates a number as the assessment of the given move. The base
    implementation calculates the resulting game state and returns the 
    stateEvaluation of it.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">moveEvaluation</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">moveEvaluation</span><span class="p">(</span><span class="nx">move</span><span class="p">,</span> <span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">stateEvaluation</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">obj</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span> <span class="nx">move</span><span class="p">)),</span> <span class="nx">player</span><span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.HeuristicPlayer.stateEvaluation(game, player):
    Calculates a number as the assessment of the given game state. The 
    base implementation returns the result for the player is the game 
    has results. Else it returns the heuristic value for the state.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">stateEvaluation</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">stateEvaluation</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">gameResult</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">result</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">gameResult</span> <span class="o">?</span> <span class="nx">gameResult</span><span class="p">[</span><span class="nx">player</span><span class="p">]</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">heuristic</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.HeuristicPlayer.heuristic(game, player):
    Game state evaluation used at states that are not finished games. The
    default implementation returns a random number in [-0.5, 0.5). This is
    only useful in testing this framework. Any serious use should redefine 
    it.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">heuristic</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">heuristic</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.HeuristicPlayer.bestMoves(evaluatedMoves):
    Given a sequence of tuples [move, evaluation], returns the moves that
    are best evaluated.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">bestMoves</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">bestMoves</span><span class="p">(</span><span class="nx">evaluatedMoves</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">iterable</span><span class="p">(</span><span class="nx">evaluatedMoves</span><span class="p">).</span><span class="nx">greater</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">pair</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="p">}).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">pair</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">});</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.HeuristicPlayer.selectMoves(moves, game, player):
    Return an array with the best evaluated moves. The evaluation is done by
    the moveEvaluation method. The default implementation always returns a
    Future.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">selectMoves</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">selectMoves</span><span class="p">(</span><span class="nx">moves</span><span class="p">,</span> <span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">heuristicPlayer</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
      <span class="nx">asyncEvaluations</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">evaluatedMoves</span> <span class="o">=</span> <span class="nx">moves</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">move</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">heuristicPlayer</span><span class="p">.</span><span class="nx">moveEvaluation</span><span class="p">(</span><span class="nx">move</span><span class="p">,</span> <span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="k">instanceof</span> <span class="nx">Future</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">asyncEvaluations</span> <span class="o">=</span> <span class="nx">asyncEvaluations</span> <span class="o">||</span> <span class="kc">true</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">[</span><span class="nx">move</span><span class="p">,</span> <span class="nx">e</span><span class="p">];</span>
          <span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">[</span><span class="nx">move</span><span class="p">,</span> <span class="nx">e</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">asyncEvaluations</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Avoid using Future if possible.</span>
      <span class="k">return</span> <span class="nx">Future</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">evaluatedMoves</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bestMoves</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">bestMoves</span><span class="p">(</span><span class="nx">evaluatedMoves</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.HeuristicPlayer.decision(game, player):
    Selects randomly from the best evaluated moves.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">decision</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">decision</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">heuristicPlayer</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
      <span class="nx">selectedMoves</span> <span class="o">=</span> <span class="nx">heuristicPlayer</span><span class="p">.</span><span class="nx">selectMoves</span><span class="p">(</span><span class="nx">heuristicPlayer</span><span class="p">.</span><span class="nx">__moves__</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">),</span> <span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">Future</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">selectedMoves</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selectedMoves</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">heuristicPlayer</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">choice</span><span class="p">(</span><span class="nx">selectedMoves</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span> <span class="c1">// declare HeuristicPlayer.</span></div></div></div></div></body></html>