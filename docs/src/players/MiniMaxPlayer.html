<!DOCTYPE html><html lang="en"><head><title>src\players\MiniMaxPlayer</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="src\players\MiniMaxPlayer"><meta name="groc-project-path" content="src\players\MiniMaxPlayer.js"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src\players\MiniMaxPlayer.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>Automatic players based on pure MiniMax.</p></div></div><div class="code"><div class="wrapper"><span class="kd">var</span> <span class="nx">MiniMaxPlayer</span> <span class="o">=</span> <span class="nx">players</span><span class="p">.</span><span class="nx">MiniMaxPlayer</span> <span class="o">=</span> <span class="nx">declare</span><span class="p">(</span><span class="nx">HeuristicPlayer</span><span class="p">,</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>new players.MiniMaxPlayer(params):
    Builds a player that chooses its moves using the MiniMax algorithm.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">MiniMaxPlayer</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">HeuristicPlayer</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
    <span class="nx">initialize</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.MiniMaxPlayer.horizon=4:
    Maximum depth for the MiniMax search.</p></div></div><div class="code"><div class="wrapper">      <span class="p">.</span><span class="nx">integer</span><span class="p">(</span><span class="s1">&#39;horizon&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">defaultValue</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">coerce</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.MiniMaxPlayer.stateEvaluation(game, player):
    Returns the minimax value for the given game and player.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">stateEvaluation</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">stateEvaluation</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">minimax</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.MiniMaxPlayer.quiescence(game, player, depth):
    An stability test for the given game state. If the game is quiescent, 
    this function must return an evaluation. Else it must return NaN or an
    equivalente value. 
    Final game states are always quiescent, and their evaluation is the 
    game's result for the given player. This default implementation also 
    return an heuristic evaluation for every game state at a deeper depth 
    than the player's horizon.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">quiescence</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">quiescence</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">depth</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">result</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">results</span><span class="p">[</span><span class="nx">player</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">depth</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">horizon</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">heuristic</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">NaN</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.MiniMaxPlayer.minimax(game, player, depth):
    Minimax evaluation of the given game for the given player. If the game
    is not finished and the depth is greater than the horizon, the heuristic
    is used.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">minimax</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">minimax</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">depth</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">quiescence</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">depth</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// game is not quiescent.</span>
      <span class="kd">var</span> <span class="nx">activePlayer</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">activePlayer</span><span class="p">(),</span>
        <span class="nx">moves</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__moves__</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">activePlayer</span><span class="p">),</span> 
        <span class="nx">comparison</span><span class="p">,</span> <span class="nx">next</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">moves</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;No moves for unfinished game &#39;</span><span class="o">+</span> <span class="nx">game</span> <span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">activePlayer</span> <span class="o">==</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">;</span>
        <span class="nx">comparison</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="o">+</span><span class="kc">Infinity</span><span class="p">;</span>
        <span class="nx">comparison</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">moves</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">next</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">obj</span><span class="p">(</span><span class="nx">activePlayer</span><span class="p">,</span> <span class="nx">moves</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">comparison</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">minimax</span><span class="p">(</span><span class="nx">next</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">},</span>
  
  <span class="nx">toString</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">toString</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="s1">&#39;MiniMaxPlayer&#39;</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;(&#39;</span><span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
      <span class="nx">name</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">horizon</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">horizon</span>
    <span class="p">})</span> <span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span> <span class="c1">// declare MiniMaxPlayer.</span></div></div></div></div></body></html>