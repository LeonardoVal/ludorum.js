<!DOCTYPE html><html lang="en"><head><title>src\players\MaxNPlayer</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="src\players\MaxNPlayer"><meta name="groc-project-path" content="src\players\MaxNPlayer.js"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src\players\MaxNPlayer.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>Automatic players based on the MaxN algorithm.</p></div></div><div class="code"><div class="wrapper"><span class="kd">var</span> <span class="nx">MaxNPlayer</span> <span class="o">=</span> <span class="nx">players</span><span class="p">.</span><span class="nx">MaxNPlayer</span> <span class="o">=</span> <span class="nx">declare</span><span class="p">(</span><span class="nx">HeuristicPlayer</span><span class="p">,</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>new players.MaxNPlayer(params):
    Builds a player that chooses its moves using the MiniMax algorithm with
    alfa-beta pruning.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">MaxNPlayer</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">HeuristicPlayer</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
    <span class="nx">initialize</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.MaxNPlayer.horizon=3:
    Maximum depth for the MiniMax search.</p></div></div><div class="code"><div class="wrapper">      <span class="p">.</span><span class="nx">integer</span><span class="p">(</span><span class="s1">&#39;horizon&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">defaultValue</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">coerce</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.MaxNPlayer.stateEvaluation(game, player):
    Returns the minimax value for the given game and player.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">stateEvaluation</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">stateEvaluation</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxN</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="mi">0</span><span class="p">)[</span><span class="nx">player</span><span class="p">];</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.MaxNPlayer.heuristics(game):
    Returns the heuristics value for each players in the game, as an object.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">heuristics</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">heuristic</span><span class="p">(</span><span class="nx">game</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">maxN</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">game</span><span class="p">.</span><span class="nx">players</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">role</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">[</span><span class="nx">role</span><span class="p">]</span> <span class="o">=</span> <span class="nx">maxN</span><span class="p">.</span><span class="nx">heuristic</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">role</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.MaxNPlayer.quiescence(game, player, depth):
    An stability test for the given game state. If the game is quiescent, 
    this function must return evaluations. Else it must return null. 
    Final game states are always quiescent, and their evaluations are the 
    game's result for each player. This default implementation also return 
    heuristic evaluations for every game state at a deeper depth than the 
    player's horizon.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">quiescence</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">quiescence</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">depth</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">result</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">depth</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">horizon</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">heuristics</span><span class="p">(</span><span class="nx">game</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>players.MaxNPlayer.maxN(game, player, depth):
    Return the evaluations for each player of the given game, assuming each
    player tries to maximize its own evaluation regardless of the others'.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">maxN</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">maxN</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">depth</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">quiescence</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">depth</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">values</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// game is not quiescent.</span>
      <span class="kd">var</span> <span class="nx">activePlayer</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">activePlayer</span><span class="p">(),</span>
        <span class="nx">moves</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__moves__</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">activePlayer</span><span class="p">),</span>
        <span class="nx">values</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">otherValues</span><span class="p">,</span> <span class="nx">next</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">moves</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;No moves for unfinished game &#39;</span><span class="o">+</span> <span class="nx">game</span> <span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">moves</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">next</span> <span class="o">=</span> <span class="nx">game</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">obj</span><span class="p">(</span><span class="nx">activePlayer</span><span class="p">,</span> <span class="nx">moves</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
        <span class="nx">otherValues</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxN</span><span class="p">(</span><span class="nx">next</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">otherValues</span><span class="p">[</span><span class="nx">activePlayer</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="nx">activePlayer</span><span class="p">]</span> <span class="o">||</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">values</span> <span class="o">=</span> <span class="nx">otherValues</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">values</span><span class="p">;</span>
  <span class="p">},</span>
  
  <span class="nx">toString</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">toString</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="s1">&#39;MaxNPlayer&#39;</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;(&#39;</span><span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
      <span class="nx">name</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">horizon</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">horizon</span>
    <span class="p">})</span> <span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span> <span class="c1">// declare MiniMaxPlayer.</span></div></div></div></div></body></html>